## `sntn`: Sum of Normal and Truncated Normal package

This repo is for the `sntn` package, which implements a scipy-like class for doing inference on a sum of a normal and a trunctated normal (SNTN). See the arXiv paper for more details on how this distribution can be used for data carving (a type of post-selection inference). The SNTN distribution has eight parameters:

$$
z \sim 
$$

# Installation

see pypi.

To check that the package compiled properly, please run `python3 -m sntn`.

# main classes

1. `dists.nts`: main class for the doing inference of a SNTN distribution

# Folder structure of this repo

* sntn: main package folder
* tests: unittesting folder
* examples: Jupyter notebook showing how to use the sntn package
* simulations: research work, used in arXiv paper
* figures: any figures generated by exploratory work/unittesting go here

# Toy examples

## (i) Conditional null hypothesis testing

## (ii) Filtering regime

Suppose an industrial process combines two parts together, but the first part is only kept if it's length exceeds a certain value. According to existing guidelines that first piece should be N(50,3) and if only kepy if >=50, and the second piece should be N(70,5). The code block below tests the power of the `SNTN` class to detect whether this distribution actually conforms to our null distribution: $SNT(\mu_1=50,\mu_2=70,\sigma_1=3,\sigma_2=5,a=50,b=\infty)$:

```
import numpy as np
from sntn.dists import sntn

....
```

### (iii) Data carving


# unittesting

1. test_conf_inf_solver: Makes sure that root-finding works for the Gaussian and binomial distribution
2. test_utils: Checks output from specific utility functions
3. test_grad: Makes sure that the log(f(a)+f(b)) ~ _log_gauss_approx(f(a),f(b)) works to a specific tolerance
4. test_dists_tnorm: Makes sure that the custom tnorm dist works as expected
5. test_dists_sntn: Makes sure that the main sntn dist works as expected


# Contributing

For testing, please set up the sntn conda environment: `conda env create -f env.yml`, and check that all unittests work as expected: `python3 -m pytest tests`. If any package changes are made, please run `conda env export > env.yml` as part of any pull request. 



